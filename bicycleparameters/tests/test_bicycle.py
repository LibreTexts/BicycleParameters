import numpy as np

from ..bicycle import sort_eigenmodes


def test_sort_eigenmodes():


    w = np.array([
        [-6.88390903+0.j, -2.92048758+0.j, 3.32151181+0.73198362j, 3.32151181-0.73198362j],
        [ 3.25058404+0.83425573j, 3.25058404-0.83425573j, -7.02339158+0.j, -2.92654704+0.j, ],
        [-7.16278369+0.j, 3.17964562+0.92400675j, 3.17964562-0.92400675j, -2.93267564+0.j]
    ])

    v = np.array([
        [[ 0.00196065+0.j, -0.29800463+0.j,  0.02930766-0.08781924j,  0.02930766+0.08781924j],
         [ 0.14374404+0.j,  0.127017  +0.j, -0.26020427+0.05734294j, -0.26020427-0.05734294j],
         [-0.01349694+0.j,  0.87031883+0.j,  0.16162797-0.27023993j,  0.16162797+0.27023993j],
         [-0.98952091+0.j, -0.37095156+0.j, -0.90624564+0.j,         -0.90624564-0.j]],
        [[ -0.01543099+0.09712139j, -0.01543099-0.09712139j,  0.00191713+0.j, -0.30037796+0.j,],
         [  0.25968865-0.06664856j,  0.25968865+0.06664856j,  0.14094669+0.j,  0.11968475+0.j,],
         [ -0.13118381+0.30282786j, -0.13118381-0.30282786j, -0.01346473+0.j,  0.87907022+0.j,],
         [  0.89974174+0.j,          0.89974174-0.j        , -0.98992376+0.j, -0.35026304+0.j,]],
        [[ 0.00184873+0.j,  0.00157195-0.10415391j,  0.00157195+0.10415391j, -0.30250698+0.j],
         [ 0.13825716+0.j, -0.25897887+0.0752594j , -0.25897887-0.0752594j ,  0.11247147+0.j],
         [-0.01324205+0.j,  0.10123715-0.32972004j,  0.10123715+0.32972004j,  0.88715484+0.j],
         [-0.99030611+0.j, -0.89300123+0.j,         -0.89300123-0.j        , -0.32984235+0.j]]
    ])

    w_expected = np.array([
        [-6.88390903+0.j, -2.92048758+0.j, 3.32151181+0.73198362j, 3.32151181-0.73198362j],
        [-7.02339158+0.j, -2.92654704+0.j, 3.25058404+0.83425573j, 3.25058404-0.83425573j],
        [-7.16278369+0.j, -2.93267564+0.j, 3.17964562+0.92400675j, 3.17964562-0.92400675j]
    ])

    v_expected = np.array([
        [[ 0.00196065+0.j, -0.29800463+0.j,  0.02930766-0.08781924j,  0.02930766+0.08781924j],
         [ 0.14374404+0.j,  0.127017  +0.j, -0.26020427+0.05734294j, -0.26020427-0.05734294j],
         [-0.01349694+0.j,  0.87031883+0.j,  0.16162797-0.27023993j,  0.16162797+0.27023993j],
         [-0.98952091+0.j, -0.37095156+0.j, -0.90624564+0.j,         -0.90624564-0.j]],
        [[ 0.00191713+0.j, -0.30037796+0.j, -0.01543099+0.09712139j, -0.01543099-0.09712139j],
         [ 0.14094669+0.j,  0.11968475+0.j,  0.25968865-0.06664856j,  0.25968865+0.06664856j],
         [-0.01346473+0.j,  0.87907022+0.j, -0.13118381+0.30282786j, -0.13118381-0.30282786j],
         [-0.98992376+0.j, -0.35026304+0.j,  0.89974174+0.j,          0.89974174-0.j]],
        [[ 0.00184873+0.j, -0.30250698+0.j,  0.00157195-0.10415391j,  0.00157195+0.10415391j],
         [ 0.13825716+0.j,  0.11247147+0.j, -0.25897887+0.0752594j , -0.25897887-0.0752594j ],
         [-0.01324205+0.j,  0.88715484+0.j,  0.10123715-0.32972004j,  0.10123715+0.32972004j],
         [-0.99030611+0.j, -0.32984235+0.j, -0.89300123+0.j,         -0.89300123-0.j]]
    ])

    w_sorted, v_sorted = sort_eigenmodes(w, v)

    np.testing.assert_allclose(w_sorted, w_expected)
    np.testing.assert_allclose(v_sorted, v_expected)
